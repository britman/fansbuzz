<html>
	<head>
        <title>Welcome to FansBuzz!</title>  
        <script type="text/javascript" src="AIRAliases.js"></script>
		<script type="text/javascript" src="lib/jquery/jquery.js"></script>
		<script type="text/javascript" src="lib/json2.js"></script>
		<script type="application/x-shockwave-flash" src="servicemonitor.swf" />   
	    <link href="main.css" rel="stylesheet" type="text/css"/>  
        <script type="text/javascript">
        	var feed = "http://www.fansbuzz.com/?mode=RSS"	
			var monitor = ""; 
					
			//set up a network check for http traffic
			function checkConnection()
			{				
				monitor = new air.URLMonitor(new air.URLRequest("http://www.adobe.com")); 
				monitor.pollInterval = 1000;  
				monitor.addEventListener(air.StatusEvent.STATUS, function(){fetchItems();}); 
		        monitor.start(); 			
			}
		

			//get the items
			function fetchItems() {
					$("#wrapper").empty();
					$("#loader").show();				 	 
					request = new air.URLRequest(feed);  
					loader = new air.URLLoader(); 
					loader.addEventListener(air.Event.COMPLETE, fetchComplete); 
					try { 
						if (monitor.available) {
							loader.load(request);
						} else{
							$("#loader").hide();
							$("#wrapper").append("<h3>Oh dear your connection with FansBuzz.com has been lost. Don't worry as we will try and get the latest stories again shortly. In the mean time, grab a cuppa, we'll be back soon.</h3>");							
						}
					 } catch (error) { 
					 	air.trace("Unable to load URL"); 
					 } 
    				 //set call back
 					var _self = this; 
					setInterval(function(){this.fetchItems.apply(_self);}, 60000 * 10);	
			}
			
			function fetchComplete(event) { 
				var domParser = new DOMParser();					
				newsXML = domParser.parseFromString(event.target.data, "text/xml");
				var introTitle = newsXML.getElementsByTagName("channel")[0].childNodes[1].textContent;
				items = newsXML.getElementsByTagName("item");
				$("#wrapper").append("<h2 id=\"intro\">" + introTitle + "<h2>");
				for (var i = 0; i < items.length; i++) {
						var link = items[i].childNodes[5].textContent;
						var title = "<h2><a href=\"#\" id=\"" + link +"\">" + items[i].childNodes[1].textContent + "</a></h2>"
						var description = "<h3>" + items[i].childNodes[3].textContent + "</h3>"

						$("#wrapper").append(title);
						document.getElementById(link).addEventListener("click", 
							function() {
								 air.navigateToURL( new air.URLRequest(this.id)); 
								 });						
						$("#wrapper").append(description);
				}	
				$("#loader").hide();				
			}	
			
			function SetFeedAndReload(url)
			{
				feed = url;
				fetchItems();	
			}
			
			function Go(url) {
				 air.navigateToURL( new air.URLRequest(url)); 
			}
            			
			function TabSet(tab)
			{
				var curSelTab = document.getElementById("selected")
				tab.id = "selected";
				if(curSelTab != null)
				{
					curSelTab.id = "";
				}
				curSelTab = tab;
			}
        </script>
	</head>

    <body onload="checkConnection();">       
        <div id="hd"><img src="images/logo.png" alt="FansBuzz - your team, your news" /></div>
		<div id="menu"><a href="#" id="selected" onclick="SetFeedAndReload('http://www.fansbuzz.com/?mode=RSS');TabSet(this)">new</a> | <a href="#" onclick="SetFeedAndReload('http://www.fansbuzz.com/?type=buzz&mode=RSS');TabSet(this)">buzz</a> | <a href="#" onclick="Go('http://www.fansbuzz.com/item')">publish</a> | <a href="#" onclick="Go('http://www.fansbuzz.com/contact')">contact</a></div>
		<div id="wrapper"></div>
		<div id="loader" align="center">Getting the latest stories...<br /><img src="images/ajax-loader.gif" /></div>
		<div id="ft"><a href="#" onclick="Go('http://www.fansbuzz.com')">FansBuzz</a> is a source for what's new and hot in the world of football. FansBuzz tracks what stories people are reading and ensures that the "latest buzz" rises to the top.</div>
    </body>
</html>